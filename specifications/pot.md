# Proof-of-Task (PoT) Specification

## 1. Overview

The Proof-of-Task (PoT) is a compact, verifiable cryptographic receipt that proves a mobile device has successfully completed an assigned task. It is designed to be lightweight to generate and fast to verify, making it suitable for a mobile-first environment.

## 2. Data Structure

The PoT is a data structure that contains the following fields:

```
{
  "task_id": "string",
  "device_id": "string",
  "timestamp": "int64",
  "output_digest": "string",
  "checkpoint": "string",
  "execution_metadata": {
    "execution_time_ms": "int",
    "cpu_cycles": "int"
  },
  "signature": "string"
}
```

### 2.1. Fields

- **`task_id`**: A unique identifier for the assigned task.
- **`device_id`**: The unique identifier of the device that executed the task.
- **`timestamp`**: The Unix timestamp (in milliseconds) when the proof was generated.
- **`output_digest`**: A cryptographic hash (e.g., SHA-256) of the task's output. This allows for verification of the result without sending the entire output.
- **`checkpoint`**: A cryptographic hash that binds the task to the device and a partial trace of the execution. This is the core of the PoT's verifiability.
- **`execution_metadata`**: Additional data about the task's execution, which can be used for performance analysis and reputation scoring.
- **`signature`**: A digital signature of the entire PoT data structure (excluding the signature field itself), created using the device's private key.

### 2.2. Checkpoint (`C`)

The checkpoint is a critical component of the PoT. It is a hash calculated as follows:

**`C = H(task_id || device_nonce || partial_trace)`**

- **`H`**: A cryptographic hash function (e.g., SHA-256).
- **`task_id`**: The unique identifier of the task.
- **`device_nonce`**: A random nonce generated by the device for this specific task. This prevents replay attacks.
- **`partial_trace`**: A small, deterministic sample of the task's execution trace. For example, it could be a hash of a specific intermediate value calculated during the task.

## 3. Verification Process

The verification of a PoT is a multi-step process:

1.  **Signature Verification**: The verifier uses the device's public key to verify the signature of the PoT. This ensures the authenticity and integrity of the proof.
2.  **Timestamp Check**: The verifier checks that the timestamp is within an acceptable window to prevent replay attacks.
3.  **Spot-Checking**: The verifier can perform a randomized spot-check by requesting the device to re-calculate a small part of the task, using a seed derived from the microblock digest. The device should be able to reproduce the same `partial_trace` and therefore the same `checkpoint`.

## 4. Example

For a task of classifying an image, the PoT might look like this:

- `task_id`: "img-classify-123"
- `device_id`: "device-abc"
- `timestamp`: 1678886400000
- `output_digest`: "sha256:..." (hash of the classification result, e.g., "cat")
- `checkpoint`: "sha256:..." (hash of "img-classify-123" + nonce + hash of a specific layer's output)
- `execution_metadata`: { "execution_time_ms": 120, "cpu_cycles": 5000000 }
- `signature`: "..."
